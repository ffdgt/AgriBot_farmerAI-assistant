<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AgriBot - Home</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
    body {
        font-family: 'Inter', sans-serif;
        min-height: 100vh;
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        justify-content: start;
        align-items: center;
        background: linear-gradient(to bottom, rgba(19,213,103,0.5), rgba(239,246,255,0.7)),
                    url('https://eos.com/wp-content/uploads/2023/04/rice-field.jpg.webp') no-repeat center center fixed;
        background-size: cover;
        overflow: hidden;
        position: relative;
    }

    .main-heading {
        font-size: 3rem;
        font-weight: 800;
        color: #ffffff;
        margin-top: 2rem;
        margin-bottom: 1rem;
        text-align: center;
        text-shadow: 2px 2px 8px rgba(0,0,0,0.6);
        animation: slideDown 1.5s ease-out;
    }

    @keyframes slideDown {
        from { transform: translateY(-50px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }

    .modules-container {
        display: flex;
        flex-wrap: wrap;
        gap: 2rem;
        justify-content: center;
        max-width: 800px;
        z-index: 10;
    }

    .module-card {
        width: 200px;
        height: 150px;
        background: rgba(255,255,255,0.85);
        border-radius: 1rem;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.5rem;
        font-weight: 700;
        color: #065f46;
        cursor: pointer;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        box-shadow: 0 6px 15px rgba(0,0,0,0.15);
        text-align: center;
        position: relative;
    }
    .module-card:hover {
        transform: translateY(-8px) scale(1.05);
        box-shadow: 0 12px 25px rgba(0,0,0,0.25);
    }

    #weather-card {
        width: 100%;
        max-width: 300px;
        padding: 1rem;
        margin-bottom: 1.5rem;
        border-radius: 1rem;
        background: rgba(255,255,255,0.85);
        border: 1px solid #a7f3d0;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        color: #065f46;
        z-index: 10;
        text-align: center;
    }

    /* Weather Animations */
    .cloud {
        position: absolute;
        width: 200px;
        height: 100px;
        background: url('https://upload.wikimedia.org/wikipedia/commons/e/e0/Cloud_icon.svg') no-repeat center;
        background-size: contain;
        opacity: 0.6;
        top: 50px;
        animation: moveClouds linear infinite;
        z-index: 5;
    }

    @keyframes moveClouds {
        0% { left: -250px; }
        100% { left: 100%; }
    }

    .rain-drop {
        position: absolute;
        width: 2px;
        height: 15px;
        background: rgba(173, 216, 230, 0.7);
        top: -20px;
        animation: fall linear infinite;
        z-index: 5;
    }

    @keyframes fall {
        to { transform: translateY(100vh); }
    }

    .sun {
        position: absolute;
        width: 100px;
        height: 100px;
        background: radial-gradient(circle, #FFD700 60%, rgba(255,215,0,0.4) 100%);
        border-radius: 50%;
        top: 50px;
        right: 50px;
        z-index: 5;
        animation: spin 20s linear infinite;
        box-shadow: 0 0 40px 10px rgba(255, 223, 0, 0.6);
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    
    .language-switcher {
        position: absolute;
        top: 1rem;
        right: 1rem;
        z-index: 20;
    }
</style>
</head>
<body>

<!-- Language Switcher -->
<div class="language-switcher">
    <select id="language-select" class="rounded-lg p-2 bg-white text-green-800 border-2 border-green-600 font-semibold" onchange="changeLanguage(this.value)">
        <option value="en">English</option>
        <option value="te">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</option>
    </select>
</div>

<!-- Main Heading -->
<div class="main-heading" data-translate-key="agribot-title">AGRIBOT</div>

<!-- Rotating Quotes -->
<div id="quotes-wrap" class="w-full max-w-2xl mb-6">
  <div id="quote-box" class="flex items-start gap-3 p-4 rounded-xl bg-white/80 border border-emerald-200 shadow">
    <svg class="w-6 h-6 flex-shrink-0 mt-1 text-emerald-700" viewBox="0 0 24 24" fill="currentColor">
      <path d="M7.17 6A5.17 5.17 0 0 0 2 11.17V22h8V10a4 4 0 0 0-2.83-4ZM19.17 6A5.17 5.17 0 0 0 14 11.17V22h8V10a4 4 0 0 0-2.83-4Z"/>
    </svg>
    <div>
      <p id="quote-text" class="text-lg text-emerald-900 font-medium"></p>
      <p id="quote-author" class="text-sm text-emerald-700 mt-1"></p>
    </div>
  </div>
</div>

<!-- Weather Card -->
<div id="weather-card">
    <h2 class="font-bold text-xl mb-2" data-translate-key="weather-title">Current Weather</h2>
    <p id="weather-location" class="text-lg" data-translate-key="weather-location">Fetching location...</p>
    <p id="weather-temp" class="text-lg" data-translate-key="weather-temp-label"></p>
    <p id="weather-conditions" class="text-lg" data-translate-key="weather-conditions-label"></p>
    <p id="weather-humidity" class="text-lg" data-translate-key="weather-humidity-label"></p>
</div>

<!-- Weather Animations -->
<div id="weather-animations"></div>

<!-- Modules -->
<div class="modules-container">
    <div class="module-card" onclick="openModule('chat')" data-translate-key="chat-module">üí¨ Chat</div>
    <div class="module-card" onclick="window.location.href='news.html'" data-translate-key="news-module">üì∞ News</div>
    <div class="module-card" onclick="window.location.href='/facts'" data-translate-key="facts-module">üìö Facts & Info</div>
    <div class="module-card" onclick="window.location.href='/resources'" data-translate-key="resources-module">üìÇ Resources</div>
</div>

<script>
// Multilingual Translations
const translations = {
    en: {
        'agribot-title': 'AGRIBOT',
        'weather-title': 'Current Weather',
        'weather-location': 'Fetching location...',
        'weather-temp-label': 'Temperature',
        'weather-conditions-label': 'Conditions',
        'weather-humidity-label': 'Humidity',
        'chat-module': 'üí¨ Chat',
        'news-module': 'üì∞ News',
        'facts-module': 'üìö Facts & Info',
        'resources-module': 'üìÇ Resources',
        quotes: [
            { text: "Healthy soil grows healthy crops‚Äîfeed the soil, not just the plant.", author: "AgriBot" },
            { text: "Irrigate early morning or late evening to cut evaporation losses.", author: "Water-Smart Tip" },
            { text: "Rotate crops to break pest cycles and improve soil structure.", author: "Field Wisdom" },
            { text: "Test your soil every 2‚Äì3 years; guesswork is the costliest input.", author: "Soil Lab Note" },
            { text: "Integrated pest management saves money and protects pollinators.", author: "IPM Guide" }
        ],
        weather: {
            'clear sky': 'Clear Sky',
            'few clouds': 'Few Clouds',
            'scattered clouds': 'Scattered Clouds',
            'broken clouds': 'Broken Clouds',
            'shower rain': 'Shower Rain',
            'rain': 'Rain',
            'thunderstorm': 'Thunderstorm',
            'snow': 'Snow',
            'mist': 'Mist'
        }
    },
    te: {
        'agribot-title': '‡∞Ö‡∞ó‡±ç‡∞∞‡∞ø‡∞¨‡±ã‡∞ü‡±ç',
        'weather-title': '‡∞™‡±ç‡∞∞‡∞∏‡±ç‡∞§‡±Å‡∞§ ‡∞µ‡∞æ‡∞§‡∞æ‡∞µ‡∞∞‡∞£‡∞Ç',
        'weather-location': '‡∞∏‡±ç‡∞•‡∞æ‡∞®‡∞Ç ‡∞ï‡±ã‡∞∏‡∞Ç ‡∞µ‡±Ü‡∞§‡±Å‡∞ï‡±Å‡∞§‡±ã‡∞Ç‡∞¶‡∞ø...',
        'weather-temp-label': '‡∞â‡∞∑‡±ç‡∞£‡±ã‡∞ó‡±ç‡∞∞‡∞§',
        'weather-conditions-label': '‡∞™‡∞∞‡∞ø‡∞∏‡±ç‡∞•‡∞ø‡∞§‡±Å‡∞≤‡±Å',
        'weather-humidity-label': '‡∞§‡±á‡∞Æ',
        'chat-module': 'üí¨ ‡∞ö‡∞æ‡∞ü‡±ç',
        'news-module': 'üì∞ ‡∞µ‡∞æ‡∞∞‡±ç‡∞§‡∞≤‡±Å',
        'facts-module': 'üìö ‡∞µ‡∞æ‡∞∏‡±ç‡∞§‡∞µ‡∞æ‡∞≤‡±Å & ‡∞∏‡∞Æ‡∞æ‡∞ö‡∞æ‡∞∞‡∞Ç',
        'resources-module': 'üìÇ ‡∞µ‡∞®‡∞∞‡±Å‡∞≤‡±Å',
        quotes: [
            { text: "‡∞Ü‡∞∞‡±ã‡∞ó‡±ç‡∞Ø‡∞ï‡∞∞‡∞Æ‡±à‡∞® ‡∞®‡±á‡∞≤ ‡∞Ü‡∞∞‡±ã‡∞ó‡±ç‡∞Ø‡∞ï‡∞∞‡∞Æ‡±à‡∞® ‡∞™‡∞Ç‡∞ü‡∞≤‡∞®‡±Å ‡∞™‡±Ü‡∞Ç‡∞ö‡±Å‡∞§‡±Å‡∞Ç‡∞¶‡∞ø‚Äî‡∞Æ‡±ä‡∞ï‡±ç‡∞ï‡∞ï‡±Å ‡∞Æ‡∞æ‡∞§‡±ç‡∞∞‡∞Æ‡±á ‡∞ï‡∞æ‡∞ï‡±Å‡∞Ç‡∞°‡∞æ ‡∞®‡±á‡∞≤‡∞ï‡±Å ‡∞ï‡±Ç‡∞°‡∞æ ‡∞Ü‡∞π‡∞æ‡∞∞‡∞Ç ‡∞á‡∞µ‡±ç‡∞µ‡∞Ç‡∞°‡∞ø.", author: "‡∞Ö‡∞ó‡±ç‡∞∞‡∞ø‡∞¨‡±ã‡∞ü‡±ç" },
            { text: "‡∞®‡±Ä‡∞ü‡∞ø‡∞®‡∞ø ‡∞Ü‡∞µ‡∞ø‡∞∞‡∞ø ‡∞Ö‡∞µ‡±ç‡∞µ‡∞ï‡±Å‡∞Ç‡∞°‡∞æ ‡∞Ü‡∞™‡∞°‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞â‡∞¶‡∞Ø‡∞Ç ‡∞≤‡±á‡∞¶‡∞æ ‡∞∏‡∞æ‡∞Ø‡∞Ç‡∞§‡±ç‡∞∞‡∞Ç ‡∞µ‡±á‡∞≥‡∞≤‡±ç‡∞≤‡±ã ‡∞®‡±Ä‡∞∞‡±Å ‡∞™‡±Ü‡∞ü‡±ç‡∞ü‡∞Ç‡∞°‡∞ø.", author: "‡∞®‡±Ä‡∞ü‡∞ø-‡∞Æ‡±á‡∞ß‡∞∏‡±ç‡∞∏‡±Å ‡∞ö‡∞ø‡∞ü‡±ç‡∞ï‡∞æ" },
            { text: "‡∞§‡±Ü‡∞ó‡±Å‡∞≥‡±ç‡∞≤ ‡∞ö‡∞ï‡±ç‡∞∞‡∞æ‡∞≤‡∞®‡±Å ‡∞µ‡∞ø‡∞ö‡±ç‡∞õ‡∞ø‡∞®‡±ç‡∞®‡∞Ç ‡∞ö‡±á‡∞Ø‡∞°‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞Æ‡∞∞‡∞ø‡∞Ø‡±Å ‡∞®‡±á‡∞≤ ‡∞®‡∞ø‡∞∞‡±ç‡∞Æ‡∞æ‡∞£‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞Æ‡±Ü‡∞∞‡±Å‡∞ó‡±Å‡∞™‡∞∞‡∞ö‡∞°‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞™‡∞Ç‡∞ü‡∞≤‡∞®‡±Å ‡∞Æ‡∞æ‡∞∞‡±ç‡∞ö‡∞ø ‡∞Æ‡∞æ‡∞∞‡±ç‡∞ö‡∞ø ‡∞™‡∞Ç‡∞°‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø.", author: "‡∞™‡±ä‡∞≤‡∞Ç ‡∞ú‡±ç‡∞û‡∞æ‡∞®‡∞Ç" },
            { text: "‡∞™‡±ç‡∞∞‡∞§‡∞ø 2-3 ‡∞∏‡∞Ç‡∞µ‡∞§‡±ç‡∞∏‡∞∞‡∞æ‡∞≤‡∞ï‡±Å ‡∞Æ‡±Ä ‡∞®‡±á‡∞≤‡∞®‡±Å ‡∞™‡∞∞‡±Ä‡∞ï‡±ç‡∞∑‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø; ‡∞ä‡∞π‡∞ø‡∞Ç‡∞ö‡∞°‡∞Ç ‡∞ö‡∞æ‡∞≤‡∞æ ‡∞ñ‡∞∞‡±Ä‡∞¶‡±à‡∞®‡∞¶‡∞ø.", author: "‡∞®‡±á‡∞≤ ‡∞™‡±ç‡∞∞‡∞Ø‡±ã‡∞ó‡∞∂‡∞æ‡∞≤ ‡∞ó‡∞Æ‡∞®‡∞ø‡∞ï" },
            { text: "‡∞∏‡∞Æ‡∞ó‡±ç‡∞∞ ‡∞§‡±Ü‡∞ó‡±Å‡∞≤‡±Å ‡∞®‡∞ø‡∞∞‡±ç‡∞µ‡∞π‡∞£ ‡∞°‡∞¨‡±ç‡∞¨‡±Å‡∞®‡±Å ‡∞Ü‡∞¶‡∞æ ‡∞ö‡±á‡∞∏‡±ç‡∞§‡±Å‡∞Ç‡∞¶‡∞ø ‡∞Æ‡∞∞‡∞ø‡∞Ø‡±Å ‡∞™‡±Å‡∞™‡±ç‡∞™‡±ä‡∞°‡∞ø ‡∞µ‡∞æ‡∞π‡∞ï‡∞æ‡∞≤‡∞®‡±Å ‡∞∞‡∞ï‡±ç‡∞∑‡∞ø‡∞∏‡±ç‡∞§‡±Å‡∞Ç‡∞¶‡∞ø.", author: "‡∞ê‡∞™‡∞ø‡∞é‡∞Ç ‡∞ó‡±à‡∞°‡±ç" }
        ],
        weather: {
            'clear sky': '‡∞§‡±Ü‡∞≤‡±ç‡∞≤‡∞®‡∞ø ‡∞Ü‡∞ï‡∞æ‡∞∂‡∞Ç',
            'few clouds': '‡∞ï‡±ä‡∞®‡±ç‡∞®‡∞ø ‡∞Æ‡±á‡∞ò‡∞æ‡∞≤‡±Å',
            'scattered clouds': '‡∞ö‡±Ü‡∞≤‡±ç‡∞≤‡∞æ‡∞ö‡±Ü‡∞¶‡±Å‡∞∞‡±Å‡∞ó‡∞æ ‡∞â‡∞®‡±ç‡∞® ‡∞Æ‡±á‡∞ò‡∞æ‡∞≤‡±Å',
            'broken clouds': '‡∞µ‡∞ø‡∞∞‡∞ø‡∞ó‡∞ø‡∞® ‡∞Æ‡±á‡∞ò‡∞æ‡∞≤‡±Å',
            'shower rain': '‡∞ö‡∞ø‡∞®‡±Å‡∞ï‡±Å‡∞≤‡±Å',
            'rain': '‡∞µ‡∞∞‡±ç‡∞∑‡∞Ç',
            'thunderstorm': '‡∞â‡∞∞‡±Å‡∞Æ‡±Å‡∞≤‡∞§‡±ã ‡∞ï‡±Ç‡∞°‡∞ø‡∞® ‡∞µ‡∞∞‡±ç‡∞∑‡∞Ç',
            'snow': '‡∞Æ‡∞Ç‡∞ö‡±Å',
            'mist': '‡∞™‡±ä‡∞ó‡∞Æ‡∞Ç‡∞ö‡±Å'
        }
    }
};

let currentLanguage = 'en';
const qText = document.getElementById('quote-text');
const qAuthor = document.getElementById('quote-author');
const qBox = document.getElementById('quote-box');

// Function to change the language
function changeLanguage(lang) {
    currentLanguage = lang;
    document.documentElement.lang = lang;
    document.querySelectorAll('[data-translate-key]').forEach(element => {
        const key = element.getAttribute('data-translate-key');
        if (translations[lang][key]) {
            element.textContent = translations[lang][key];
        }
    });

    // Reset quote index and rerender
    i = 0;
    renderQuote(i, true);
    
    // Refresh weather info to update labels
    getWeatherByLocation();
}

// Quotes
let i = 0;
function renderQuote(index, first = false) {
    const quotes = translations[currentLanguage].quotes;
    if (!first) {
        qBox.classList.remove('quote-enter');
        qBox.classList.add('quote-exit');
        setTimeout(() => {
            qText.textContent = `‚Äú${quotes[index].text}‚Äù`;
            qAuthor.textContent = `‚Äî ${quotes[index].author}`;
            qBox.classList.remove('quote-exit');
            qBox.classList.add('quote-enter');
        }, 380);
    } else {
        qText.textContent = `‚Äú${quotes[index].text}‚Äù`;
        qAuthor.textContent = `‚Äî ${quotes[index].author}`;
        qBox.classList.add('quote-enter');
    }
}

// Initial quote render
renderQuote(i, true);
setInterval(() => {
    i = (i + 1) % translations[currentLanguage].quotes.length;
    renderQuote(i);
}, 5000);

// Open Module
function openModule(module) {
    if (module === 'chat') {
        window.location.href = `/chatpage`;
    } else {
        window.location.href = `/app?module=${module}`;
    }
}

// Weather fetch & animations
function fetchWeather(locationOrLat, lon = null) {
    let url = '';
    if (lon !== null) {
        // Use coordinates
        url = `/weather?lat=${locationOrLat}&lon=${lon}`;
    } else {
        // Use a city name
        url = `/weather?location=${locationOrLat}`;
    }

    fetch(url)
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            if (data.error) {
                document.getElementById('weather-card').innerHTML = `<p class="text-red-600">${data.error}</p>`;
                return;
            }
            const lang = currentLanguage;
            const translatedConditions = translations[lang].weather[data.conditions.toLowerCase()] || data.conditions;

            document.getElementById('weather-location').textContent = `${translations[lang]['weather-location']}: ${data.location}`;
            document.getElementById('weather-temp').textContent = `${translations[lang]['weather-temp-label']}: ${data.temperature}¬∞C`;
            document.getElementById('weather-conditions').textContent = `${translations[lang]['weather-conditions-label']}: ${translatedConditions}`;
            document.getElementById('weather-humidity').textContent = `${translations[lang]['weather-humidity-label']}: ${data.humidity}%`;

            const animDiv = document.getElementById('weather-animations');
            animDiv.innerHTML = '';
            const condition = data.conditions.toLowerCase();

            if (condition.includes('cloud')) {
                for (let j = 0; j < 3; j++) {
                    const cloud = document.createElement('div');
                    cloud.className = 'cloud';
                    cloud.style.top = `${50 + j * 60}px`;
                    cloud.style.animationDuration = `${50 + j * 20}s`;
                    animDiv.appendChild(cloud);
                }
            } else if (condition.includes('rain')) {
                for (let j = 0; j < 100; j++) {
                    const drop = document.createElement('div');
                    drop.className = 'rain-drop';
                    drop.style.left = `${Math.random() * 100}vw`;
                    drop.style.animationDuration = `${0.5 + Math.random() * 0.5}s`;
                    drop.style.animationDelay = `${Math.random() * 2}s`;
                    animDiv.appendChild(drop);
                }
            } else if (condition.includes('sun') || condition.includes('clear')) {
                const sun = document.createElement('div');
                sun.className = 'sun';
                animDiv.appendChild(sun);
            }
        })
        .catch(err => console.error(err));
}

// Function to get the user's location and fetch weather
function getWeatherByLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
            (position) => {
                const lat = position.coords.latitude;
                const lon = position.coords.longitude;
                fetchWeather(lat, lon); // Call fetchWeather with coordinates
            },
            (error) => {
                console.error("Geolocation error: ", error);
                document.getElementById('weather-location').textContent = 'Geolocation is not supported. Showing default weather.';
                fetchWeather('Hanamkonda'); // Fallback to a default location
            }
        );
    } else {
        document.getElementById('weather-location').textContent = 'Geolocation is not supported. Showing default weather.';
        fetchWeather('Hanamkonda'); // Fallback
    }
}

document.addEventListener('DOMContentLoaded', getWeatherByLocation);
</script>
</body>
</html>
